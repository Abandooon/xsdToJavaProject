package {{ packageName }};

public class {{ wrapperClassName }} {

    private {{ originalClassName }} {{ originalVariableName }};

    public {{ wrapperClassName }}({{ originalClassName }} {{ originalVariableName }}) {
        this.{{ originalVariableName }} = {{ originalVariableName }};
    }

   {% for attribute in attributes %}
    // Getter 方法
    public {{ attribute.type }} get{{ attribute.name[0]|upper + attribute.name[1:] }}() {
        {% if attribute.type.startswith('ArrayList') and 'Wrapper' in attribute.type %}
        // 如果返回值是 ArrayList<**Wrapper>
        if ({{ originalVariableName }}.get{{ attribute.name[0]|upper + attribute.name[1:] }}() != null) {
            // 获取原始 ArrayList
            List<{{ attribute.type.split('<')[1].replace('>', '') }}> originalList = {{ originalVariableName }}.get{{ attribute.name[0]|upper + attribute.name[1:] }}();

            // 将原始 ArrayList 中的每个元素包装为对应的 Wrapper 对象
            List<{{ attribute.type.split('<')[1].replace('>', '') }}Wrapper> wrapperList = originalList.stream()
                .map(item -> new {{ attribute.type.split('<')[1].replace('>', '') }}Wrapper(item))
                .collect(Collectors.toList());

            // 返回包装后的 ArrayList
            return new ArrayList<>(wrapperList);
        } else {
            return null;  // 如果原始 ArrayList 为空，返回空的 ArrayList
        }
        {% else %}
        // 如果返回值不是 ArrayList<**Wrapper>
        if ({{ originalVariableName }}.get{{ attribute.name[0]|upper + attribute.name[1:] }}() != null) {
            return new {{ attribute.type }}({{ originalVariableName }}.get{{ attribute.name[0]|upper + attribute.name[1:] }}());
        } else {
            return null;
        }
        {% endif %}
    }
{% endfor %}



    // 动态生成 getRefObject 方法
    {% if hasRefObject %}
    public Object get{{ originalClassName }}Obj() throws BaseXException, ClassNotFoundException, JAXBException, SecurityException, NoSuchMethodException, IllegalArgumentException, IllegalAccessException, InvocationTargetException, InstantiationException {
        java.lang.String path = {{ originalVariableName }}.getValue();
        java.lang.String type = {{ originalVariableName }}.getDest().toString().replace("_", "-");
        SchemaController schemaController = (SchemaController) RestrictDTO.controllerMap.get("schemaController");
        java.lang.String className = schemaController.convertClassName(type);
        Iproject currentProject = (Iproject) ApplicationContextUtil.applicationContext.get("currentProject");
        Object queryObject = schemaController.queryObject(currentProject.getName(), path, type);
        java.lang.String wrapperClassName = "{{package_name}}" + className + "Wrapper";
        Class<?> wrapperClass = Class.forName(wrapperClassName);
        Constructor<?> wrapperConstructor = wrapperClass.getConstructor(queryObject.getClass());
        Object wrapperInstance = wrapperConstructor.newInstance(queryObject);
        return wrapperInstance;
    }
    {% for method in additionalApiMethods %}
    public {% if method.has_wrapper %}{{ method.annotation_pascal_case }}Wrapper{% else %}{{ method.annotation_pascal_case }}{% endif %} get{{ method.annotation_pascal_case }}() throws BaseXException, ClassNotFoundException, JAXBException{
        java.lang.String path = {{ originalVariableName }}.getValue();
        java.lang.String type = {{ originalVariableName }}.getDest().toString().replace("_", "-");
        SchemaController schemaController = (SchemaController) RestrictDTO.controllerMap.get("schemaController");
        Iproject currentProject = (Iproject) ApplicationContextUtil.applicationContext.get("currentProject");
        Object queryObject = schemaController.queryObject(currentProject.getName(), path, type);
        {% if method.has_wrapper %}
        if(queryObject instanceof {{ method.annotation_pascal_case }}){
            return new {{ method.annotation_pascal_case }}Wrapper(({{ method.annotation_pascal_case }}) queryObject);
        }else{
            return null;
        }
        {% else %}
        if(queryObject instanceof {{ method.annotation_pascal_case }}){
            return ({{ method.annotation_pascal_case }}) queryObject;
        }else{
            return null;
        }
        {% endif %}
    }
    {% endfor %}
    {% endif %}

     // 根据变体注解生成getValue方法
    {% if hasArrayListSerializable %}
    public String getValue() {
        ArrayList<Serializable> serializables = {{ originalVariableName }}.getContent();
        StringBuilder textContent = new StringBuilder();
        for (Serializable item : serializables) {
            if (item instanceof String) {
                textContent.append((String) item);
            }
        }
        return textContent.toString().trim();
    }
    // 根据变体注解生成 get各element ref 方法
    {% for method in additionalApiMethods %}
    public List<{% if method.has_wrapper %}{{ method.annotation_pascal_case }}Wrapper{% else %}{{ method.annotation_pascal_case }}{% endif %}> get{{ method.annotation_pascal_case }}Refs() {
    ArrayList<Serializable> serializables = {{ method.original_variable_name }}.getContent();
    TypeCast typeCast = new TypeCast();
    {% if method.has_wrapper %}
    ArrayList<{{ method.annotation_pascal_case }}> objects = typeCast.getElementsOfType(serializables, {{ method.annotation_pascal_case }}.class);
    ArrayList<{{ method.annotation_pascal_case }}Wrapper> wrapperObjects = new ArrayList<>();
    wrapperObjects = (ArrayList<{{ method.annotation_pascal_case }}Wrapper>) objects.stream()
        .map(a -> new {{ method.annotation_pascal_case }}Wrapper(a))
        .collect(Collectors.toList());
    return wrapperObjects;
    {% else %}
    return typeCast.getElementsOfType(serializables, {{ method.annotation_pascal_case }}.class);
    {% endif %}
    }
    {% endfor %}
    {% endif %}
}
